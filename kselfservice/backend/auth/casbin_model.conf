
# Casbin model configuration
#
# Docs:
# - https://casbin.org/docs/model
# - https://casbin.org/docs/supported-models
# - https://casbin.org/docs/function
#
# Notes for this demo:
# - We include a 4th request field, `app`, to enable ABAC-style checks
#   against per-app roles.
# - We use `eval(p.cond)` so policies can contain conditional expressions (e.g. True).

[request_definition]
# r = request definition (what the enforcer receives at runtime)
# Here: sub=user context, obj=path, act=HTTP method, app=context object
r = sub, obj, act, app

[policy_definition]
# p = policy definition (what each policy line in casbin_policy.csv provides)
# Here: sub=role, obj=path pattern, act=method regex, cond=condition expression
p = sub, obj, act, cond

[role_definition]
# g = role inheritance definition (not heavily used in this demo since we model roles
# as lists on the user object, but kept for completeness)
g = _, _

[policy_effect]
# effect: allow if any matched policy is allow
e = some(where (p.eft == allow))

[matchers]
# matcher: determines whether a given request matches a given policy
#
# - (p.sub in r.sub.roles)
#     Global roles (e.g. admin/viewall/user) attached to the authenticated user.
# - (p.sub in r.sub.app_roles.get(r.app.id, []))
#     Per-app roles (viewer/recertify) for a specific app id.
# - keyMatch(r.obj, p.obj)
#     Path matching (e.g. /apps/network matches /apps/*)
# - regexMatch(r.act, p.act)
#     Method matching (e.g. GET matches (GET|POST))
# - eval(p.cond)
#     Evaluates the conditional expression from the policy (Python-like via simpleeval).
m = (p.sub in r.sub.roles || p.sub in r.sub.app_roles.get(r.app.id, [])) && keyMatch(r.obj, p.obj) && regexMatch(r.act, p.act) && eval(p.cond)
